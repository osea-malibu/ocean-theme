class v extends HTMLElement{constructor(){super(),this.selectedCategories=[],this.sortByValue="az",this.currentPage=1,this.itemsPerPage=10,this.metaObjects=[],this.loading=!0,this.filterForm=document.getElementById("filter-form"),this.sortForm=document.getElementById("sort-form"),this.searchForm=document.getElementById("search-form"),this.listCountFieldset=document.getElementById("list-count"),this.initializeFromUrl(),this.initializeFilters(),this.initializeSorts(),this.initializeSearch(),this.initializeListCount(),this.getAllIngredients()}initializeFromUrl(){const t=new URLSearchParams(window.location.search);if(t.has("page")&&(this.currentPage=parseInt(t.get("page"),10)),t.has("category")){this.selectedCategories=t.get("category").split(","),this.filterForm.querySelectorAll('input[name="category"]').forEach(i=>{this.selectedCategories.includes(i.value)?i.checked=!0:i.checked=!1});const s=this.filterForm.querySelector('input[value="all"]'),r=this.querySelector(".category-dropdown-text");this.selectedCategories.length>0&&!this.selectedCategories.includes("all")?(s.checked=!1,r.innerText=`${this.selectedCategories.join(", ")}`):(s.checked=!0,r.innerText="All")}if(t.has("sort")&&(this.sortByValue=t.get("sort"),this.sortForm.querySelector("select").value=this.sortByValue),t.has("listcount")){const s=t.get("listcount");this.itemsPerPage=parseInt(s,10);const r=this.listCountFieldset.querySelector(`input[value="${s}"]`);r?r.checked=!0:console.warn(`Input with value "${s}" not found.`),this.listCountFieldset.querySelectorAll("label").forEach(a=>{a.classList.remove("font-bold")});const i=this.listCountFieldset.querySelector(`label[for="${s}"]`);i&&i.classList.add("font-bold")}if(t.has("search")){this.searchQuery=t.get("search").trim().toLowerCase();const s=this.searchForm.querySelector('input[type="text"]');s.value=this.searchQuery}this.renderPage()}updateUrlParams(){const t=new URLSearchParams;t.set("page",this.currentPage),this.selectedCategories.length>0&&t.set("category",this.selectedCategories.join(",")),t.set("sort",this.sortByValue),t.set("listcount",this.itemsPerPage),this.searchQuery&&t.set("search",this.searchQuery);const s=`${window.location.pathname}?${t.toString()}`;window.history.pushState(null,"",s)}async fetchAllMetaObjects(){const t="2cca99031c2d35261e7d140b5a386156",s="osea-malibu.myshopify.com",r=`
      query($first: Int!, $after: String) {
        metaobjects(first: $first, after: $after, type: "ingredient_glossary") {
          edges {
            node {
              id
              fields {
                key
                value
              }
            }
            cursor
          }
          pageInfo {
            hasNextPage
          }
        }
      }
    `;let i=[],a=!0,l=null;for(;a;){const e=await(await fetch(`https://${s}/api/2023-10/graphql.json`,{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":t},body:JSON.stringify({query:r,variables:{first:50,after:l}})})).json();if(e.errors)return console.error("GraphQL Error:",e.errors),[];if(e.data&&e.data.metaobjects){const n=e.data.metaobjects.edges.map(u=>u.node);i=i.concat(n),a=e.data.metaobjects.pageInfo.hasNextPage,a&&(l=e.data.metaobjects.edges[e.data.metaobjects.edges.length-1].cursor)}else console.error("No metaobjects found in the response"),a=!1}return i}async getAllIngredients(){try{this.loading=!0;const t=await this.fetchAllMetaObjects();this.metaObjects=t,this.loading=!1,this.renderPage()}catch(t){console.error("Error fetching metaobjects:",t),this.loading=!1}}initializeFilters(){this.filterForm.addEventListener("change",t=>{const s=this.filterForm.querySelectorAll('input[name="category"]'),r=this.filterForm.querySelector('input[value="all"]'),i=this.querySelector(".category-dropdown-text");if(t.target.value==="all")t.target.checked?s.forEach(a=>{a.checked=!0,i.innerText="All"}):s.forEach(a=>{a.checked=!1,i.innerText="All"}),this.selectedCategories=[];else{const a=this.filterForm.querySelectorAll('input[name="category"]:checked');this.selectedCategories=Array.from(a).map(l=>l.value),this.selectedCategories.length>0&&this.selectedCategories.length<s.length&&(r.checked=!1,i.innerText=`${this.selectedCategories.join(", ")}`),this.selectedCategories.length===s.length&&(r.checked=!0,i.innerText="All")}this.currentPage=1,this.updateUrlParams(),this.renderPage()})}initializeSorts(){this.sortForm.addEventListener("change",t=>{this.sortByValue=t.target.value,this.currentPage=1,this.updateUrlParams(),this.renderPage()})}initializeSearch(){this.searchForm.addEventListener("submit",t=>{t.preventDefault();const s=this.searchForm.querySelector('input[type="text"]').value.trim().toLowerCase();this.searchQuery=s,this.currentPage=1,this.updateUrlParams(),this.renderPage()})}initializeListCount(){this.listCountFieldset.addEventListener("change",t=>{const s=t.target.value;this.itemsPerPage=parseInt(s,10),this.listCountFieldset.querySelectorAll("label").forEach(r=>{r.classList.remove("font-bold")}),this.listCountFieldset.querySelector(`label[for="${s}"]`).classList.add("font-bold"),this.currentPage=1,this.updateUrlParams(),this.renderPage()})}filterItems(){const t=this.filterForm.querySelector('input[value="all"]');let s=this.metaObjects;return this.selectedCategories.length>0&&!t.checked&&(s=s.filter(r=>{const i=r.fields.find(a=>a.key==="category");return i?JSON.parse(i.value).some(l=>this.selectedCategories.includes(l)):!1})),this.searchQuery&&(s=s.filter(r=>{const i=r.fields.find(e=>e.key==="name"),a=r.fields.find(e=>e.key==="common_name"),l=i&&i.value.toLowerCase().includes(this.searchQuery),c=a&&a.value.toLowerCase().includes(this.searchQuery);return l||c})),s}renderPage(){const t=this.querySelector(".ingredient-list");t.querySelector("div:first-of-type").focus();const s=this.querySelector(".skeleton-list");if(this.loading){s.classList.remove("hidden"),t.classList.add("hidden");return}else s.classList.add("hidden"),t.classList.remove("hidden");const r=this.filterItems(),i=d=>d.fields.find(h=>h.key==="name").value,a=r.sort((d,h)=>i(d).localeCompare(i(h))),l=this.sortByValue==="az"?a:a.reverse(),c=(this.currentPage-1)*this.itemsPerPage,e=Math.min(c+this.itemsPerPage,l.length),n=l.slice(c,e),u=this.querySelector(".results-count");u.innerHTML=`${r.length} result${r.length>1?"s":""}`,t.innerHTML="",n.forEach(d=>{const h=d.fields.find(o=>o.key==="name"),f=d.fields.find(o=>o.key==="common_name"),m=d.fields.find(o=>o.key==="definition"),p=d.fields.find(o=>o.key==="category"),P=p?JSON.parse(p.value):[],C="rounded-full px-2 py-0.5 bg-wave-200 text-xs",g=document.createElement("div");g.classList.add("border-b","border-seaweed-300","flex","flex-col","justify-center","min-h-32","py-3"),g.innerHTML=`
        <h3><b>${h?h.value:"Unnamed"}</b></h3>
        ${f?`<em>${f.value}</em>`:""}
        <p>${m?m.value:""}</p>
        <div class="flex flex-wrap gap-1 mt-2">
          ${P.map(o=>`<div class="${C}">${o}</div>`).join("")}
        </div>
      `,t.appendChild(g)});const y=this.querySelector(".current-count");y.textContent=`Showing ${c+1} - ${e} of ${r.length}`,this.renderPagination(r.length)}renderPagination(t){const s=Math.ceil(t/this.itemsPerPage),r=this.querySelector(".pagination");r.innerHTML="";const i=2;if(this.currentPage>1){const e=document.createElement("a");e.classList.add("px-1"),e.href="#",e.setAttribute("aria-label","Go to previous page"),e.innerHTML=`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-label="Previous">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>`,e.addEventListener("click",n=>{n.preventDefault(),this.currentPage--,this.updateUrlParams(),this.renderPage()}),r.appendChild(e)}const a=document.createElement("a");if(a.href="#",a.textContent=1,a.classList.add("w-4","link"),a.setAttribute("aria-label","Go to first page"),this.currentPage===1&&a.classList.add("font-bold"),a.addEventListener("click",e=>{e.preventDefault(),this.currentPage=1,this.updateUrlParams(),this.renderPage()}),r.appendChild(a),this.currentPage>i+2){const e=document.createElement("span");e.classList.add("font-bold"),e.textContent="…",r.appendChild(e)}const l=Math.max(2,this.currentPage-i),c=Math.min(s-1,this.currentPage+i);for(let e=l;e<=c;e++){const n=document.createElement("a");n.classList.add("w-4","link"),n.href="#",n.textContent=e,n.setAttribute("aria-label",`Go to page ${e}`),e===this.currentPage&&n.classList.add("font-bold"),n.addEventListener("click",u=>{u.preventDefault(),this.currentPage=e,this.updateUrlParams(),this.renderPage()}),r.appendChild(n)}if(this.currentPage<s-i-1){const e=document.createElement("span");e.classList.add("font-bold"),e.textContent="…",r.appendChild(e)}if(s>1){const e=document.createElement("a");e.classList.add("link"),e.href="#",e.textContent=s,e.setAttribute("aria-label",`Go to page ${s}`),this.currentPage===s&&e.classList.add("font-bold"),e.addEventListener("click",n=>{n.preventDefault(),this.currentPage=s,this.updateUrlParams(),this.renderPage()}),r.appendChild(e)}if(this.currentPage<s){const e=document.createElement("a");e.classList.add("px-1"),e.href="#",e.setAttribute("aria-label","Go to next page"),e.innerHTML=`<svg class="w-5 h-5 rotate-180" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-label="Next">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>`,e.addEventListener("click",n=>{n.preventDefault(),this.currentPage++,this.updateUrlParams(),this.renderPage()}),r.appendChild(e)}}}customElements.define("ingredient-glossary",v);
