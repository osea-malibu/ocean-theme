{% comment %}
  Renders a product card for the bundle builder

  Accepts:
  - product: {Object} Product Liquid object (required)
  - variant: {Object} Override default variant (optional)
  - name: {String} Card type name (required)

  Usage:
  {% render 'bundle-card', product: section.settings.product %}
{% endcomment %}

{%- liquid
  if variant != blank
    assign card_product = variant
    assign variant_id = variant.id
  elsif product.variants.size == 1
    assign card_product = product
    assign variant_id = product.selected_or_first_available_variant.id
  else
    assign card_product = product.selected_or_first_available_variant
    assign variant_id = product.selected_or_first_available_variant.id
  endif

  assign default_image_src = card_product.featured_media | image_url: width: 328
  assign default_image_src_2x = card_product.featured_media | image_url: width: 656
  assign hover_image_src = card_product.media[1] | image_url: width: 328
  assign hover_image_src_2x = card_product.media[1] | image_url: width: 656
-%}

<div class="bundle-card flex" data-variant-id="{{ variant_id }}">
  <input type="radio" id="Input-{{ variant_id }}" class="hidden peer" name="{{ name }}" data-price="{{ card_product.price | times: 0.8 }}">
  <div class="group flex flex-col bg-white rounded-sm relative z-0 p-1 transition-all peer-checked:shadow-seaweed-700/10 border border-transparent peer-checked:shadow-lg peer-checked:border-seaweed-400 peer-checked:z-10">
    <img
      srcset="{% render 'imgix', src: default_image_src %} 1x, {% render 'imgix', src: default_image_src_2x %} 2x"
      src="{% render 'imgix', src: default_image_src_2x %}"
      alt="{{ product.featured_media.alt | escape }}"
      loading="lazy"
      width="{{ product.featured_media.width }}"
      height="{{ product.featured_media.height }}"
      id="ByobImage-{{ product.id }}"
      class="byob-modal block bg-wave-100"
    >
    <div class="byob-modal flex items-center mb-1">
      {% render 'product-rating', product: product, hide_count: true, classes: 'h-5' %}
      {%- liquid
        if product.metafields.stamped.reviews_count
          assign review_count = product.metafields.stamped.reviews_count
        else
          assign review_count = 0
        endif
      -%}
      <span aria-hidden="true" class="text-xs ml-1 font-book">({{ review_count }})</span>
    </div>
    <h3 class="byob-modal leading-none mb-1 font-book tracking-wide">{{ product.title }}</h3>
    {% render 'price', product: card_product, bundle: true, price_class: "mt-auto mb-1 font-medium tracking-wide" %}
    <label for="Input-{{ variant_id }}" data-name="{{ name }}" class="byob-add-to-bundle button button-sm button-tertiary w-full group-peer-checked:bg-seafoam-200">
      <span class="group-peer-checked:hidden">Add</span>
      <span class="hidden group-peer-checked:inline">Added!</span>
    </label>
  </div>
</div>