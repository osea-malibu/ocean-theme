{% comment %}
  Product buy buttons for OWC (Ocean Wellness Collection) branded products
  Parameters:
  - product: Product object
  - section: Section object for settings
{% endcomment %}

{%- liquid
  assign product_form_id = 'product-form-' | append: product.id | append: '-' | append: section.id
-%}

<div class="mt-auto overflow-hidden px-1 pb-1 -mb-1 -mx-1">
  {%- if product.variants.size > 1 -%}
    <variant-selects
      class="no-js-hidden block mt-1"
      data-section="{{ product.id }}-{{ section.id }}"
      data-url="{{ product.url }}"
      data-update-url="false"
    >
      {%- for option in product.options_with_values -%}
        <div class="relative block">
          <label class="absolute top-0 sm:top-px left-3 z-10 text-xs font-medium block leading-5" for="Option-{{ product.id }}-{{ forloop.index0 }}-{{ section.id }}">
            {{- option.name -}}
          </label>
          <select id="Option-{{ product.id }}-{{ forloop.index0 }}-{{ section.id }}"
            class="block input input-xs rounded-full w-full py-px sm:py-0.5 {% if option.name == 'Size' %}pl-10{% else %}pl-16{% endif %}"
            name="options[{{ option.name | escape }}]"
            form="{{ product_form_id }}"
          >
            {%- for value in option.values -%}
              <option
                value="{{ value | escape }}"
                {% if option.selected_value == value %}selected="selected"{% endif %}
              >
                {{ value }}
              </option>
            {%- endfor -%}
          </select>
        </div>
      {%- endfor -%}

      <script type="application/json" class="variant-data">
        {{ product.variants | json }}
      </script>
    </variant-selects>
  {%- endif -%}

  <product-form data-cart-type="{{ settings.cart_type }}" class="relative">
    <div class="product-form__error-message-wrapper hidden items-center mb-1" role="alert">
      {% render 'icon-error-circle', classes: 'w-4 h-4 mr-1 text-coral-800', aria_hidden: true, stroke_width: 2 %}
      <span class="product-form__error-message text-coral-800 tracking-wide text-sm font-book"></span>
    </div>

    {%- form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" disabled />
      <button
        id="{{ product_form_id }}-submit"
        type="submit"
        name="add"
        aria-haspopup="dialog"
        aria-live="polite"
        class="button button-tertiary w-full motion-safe:transition flex mt-2 disabled:opacity-50 {% if product.selected_or_first_available_variant.available %}justify-between{% else %}justify-center{% endif %}"
        {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
      >
        {%- if product.selected_or_first_available_variant.available -%}
          <span class="label">{{ 'products.product.add_to_cart' | t }}&nbsp;</span>
          {%- liquid
            assign price_id = 'price-' | append: product.id | append: '-' | append: section.id
          -%}
          {%- render 'price',
            product: product,
            price_id: price_id,
            price_class: 'tracking-wide',
            show_price_range: true,
            use_variant: true
          -%}
        {%- else -%}
          <span class="label">{{ 'products.product.sold_out' | t }}</span>
        {%- endif -%}
      </button>
      {%- if product.selected_or_first_available_variant.available == false -%}
        <div class="absolute z-10 inset-x-0 bottom-0 h-10 sm:h-[42px]">
          <div
            class="klaviyo-product-container"
            data-klaviyo-handle="{{ product.handle }}"
            id="klaviyo-data-handle-{{ product.handle }}-{{ section.id }}"
          >
            <div class="klaviyo-button-container !inset-0 !w-full !opacity-100 !-ml-0"></div>
          </div>
        </div>
      {%- endif -%}
    {%- endform -%}
  </product-form>
</div> 