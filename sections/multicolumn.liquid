<div
  class="{{ section.settings.section_classes }}"
  {% if section.settings.row_bg_image != blank %}
    style="background-image: url({{ section.settings.row_bg_image | image_url: width: 1420 }})"
  {% endif %}
>
  {%- if section.settings.is_slider and section.blocks.size > 1 -%}
    <glide-slider
      class="glide{% if section.settings.slider_breakpoint_limit != 'none' %} {{ section.settings.slider_breakpoint_limit }}:pb-0{% endif %}{% if section.settings.slider_classes != '' %} {{ section.settings.slider_classes }}{% endif %}"
      id="slider-{{ section.id }}"
      data-breakpoint-limit="{{ section.settings.slider_breakpoint_limit }}"
    >
      <div class="glide__track {{ section.settings.container_classes }}" data-glide-el="track">
  {%- endif -%}
        <ul
          class="{% if section.settings.is_slider %}glide__slides{% else %}flex md:flex-shrink-0 {{ section.settings.container_classes }}{% endif %}"
          role="presentation"
        >
          {%- for block in section.blocks -%}
            <li
              class="{{ block.settings.column_classes }}{% if section.settings.is_slider %} glide__slide{% endif %}{% if block.settings.is_bg_image %} bg-cover{% endif %}"
              {% if block.settings.is_bg_image %}style="background-image: url({{ block.settings.image | image_url: width: 1420 }})"{% endif %}
              {{ block.shopify_attributes }}
            >
              {%- case block.type -%}
                {%- when 'column' %}
                  {%- if block.settings.image != blank and block.settings.is_bg_image == false -%}
                    {%- if block.settings.image_link != blank -%}
                      <a href="{{ block.settings.image_link }}">
                    {%- endif -%}
                      <picture class="{{ block.settings.image_wrapper_classes }}">
                        {%- if block.settings.image_desktop != blank -%}
                          <source
                            srcset="{{ block.settings.image_desktop | image_url: width: 800 }} 1x, {{ block.settings.image_desktop | image_url: width: 1600 }} 2x"
                            media="(min-width: 640px)"
                          >
                        {%- else -%}
                          <source
                            srcset="{{ block.settings.image | image_url: width: 800 }} 1x, {{ block.settings.image | image_url: width: 1600 }} 2x"
                            media="(min-width: 640px)"
                          >
                        {%- endif -%}
                        <source
                          srcset="{{ block.settings.image | image_url: width: 400 }} 1x, {{ block.settings.image | image_url: width: 800 }} 2x"
                          media="(min-width: 0px)"
                        >
                        <img
                          srcset="{{ block.settings.image | image_url: width: 400 }} 1x, {{ block.settings.image | image_url: width: 800 }} 2x"
                          src="{{ block.settings.image | image_url: width: 800 }}"
                          alt="{{ block.settings.image.alt }}"
                          height="{{ block.settings.image.height }}"
                          width="{{ block.settings.image.width }}"
                          class="{{ block.settings.image_classes }}"
                          loading="lazy"
                        >
                      </picture>
                    {%- if block.settings.image_link != blank -%}
                      </a>
                    {%- endif -%}
                  {%- endif -%}
                  {%- if block.settings.heading != "" or block.settings.paragraph != "" or block.settings.button_label != "" -%}
                    <div {% if block.settings.text_classes != blank %}class="{{ block.settings.text_classes }}"{% endif %}>
                      {%- if block.settings.heading != "" -%}
                        <div class="{{ block.settings.heading_classes }}">{{- block.settings.heading -}}</div>
                      {%- endif -%}
                      {%- if block.settings.paragraph != blank -%}
                        <div class="{{ block.settings.paragraph_classes }}">
                          {%- if block.settings.paragraph != blank -%}
                            {{- block.settings.paragraph -}}
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                      {%- if block.settings.button_label != "" or block.settings.is_atc_button -%}
                        {%- if block.settings.is_atc_button and block.settings.atc_button_product != blank -%}
                          <product-form data-cart-type="{{ settings.cart_type }}">
                            <div class="product-form__error-message-wrapper hidden items-center mb-1" role="alert">
                              <span class="product-form__error-message text-coral-800 tracking-wide text-sm font-book"></span>
                            </div>

                            {%- form 'product', block.settings.atc_button_product, id: block.id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
                              <input type="hidden" name="id" value="{{ block.settings.atc_button_product.selected_or_first_available_variant.id }}" disabled>
                              <button
                                id="{{ block.id }}-submit"
                                type="submit"
                                name="add"
                                aria-haspopup="dialog"
                                aria-live="polite"
                                class="button button-tertiary w-full transition flex mt-2 disabled:opacity-50 {% if block.settings.atc_button_product.selected_or_first_available_variant.available %}justify-between{% else %}justify-center{% endif %} {{ block.settings.button_classes }}"
                                {% if block.settings.atc_button_product.selected_or_first_available_variant.available == false %}disabled{% endif %}
                              >
                                {%- if block.settings.atc_button_product.selected_or_first_available_variant.available -%}
                                  <span>{{ 'products.product.add_to_cart' | t }}</span>
                                  <span id="price-{{ block.settings.atc_button_product.id }}" class="whitespace-nowrap">
                                    {% render 'price',
                                      product: block.settings.atc_button_product,
                                      show_price_range: true,
                                      use_variant: true
                                    %}
                                  </span>
                                {%- else -%}
                                  {{ 'products.product.sold_out' | t }}
                                {%- endif -%}
                              </button>
                            {%- endform -%}
                          </product-form>
                        {%- else -%}
                          <a class="button {{ block.settings.button_classes }}" {% if block.settings.link == blank %}role="link" aria-disabled="true"{% else %}href="{{ block.settings.link }}"{% endif %}>{{- block.settings.button_label | escape -}}</a>
                        {%- endif -%}
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                {%- when 'product' %}
                  {%- if block.settings.product -%}
                    {% render 'product-card',
                      product_card_product: all_products[block.settings.product],
                      section_id: section.id,
                      show_secondary_image_on_hover: true,
                      custom_default_image: block.settings.custom_product_image
                      hide_badge: block.settings.hide_badge,
                      subscription: block.settings.subscription
                    %}
                  {%- endif -%}
                {%- when 'code' -%}
                  {%- if block.settings.code != "" -%}
                    {{- block.settings.code -}}
                  {%- endif -%}
              {%- endcase -%}
            </li>
          {%- endfor -%}
        </ul>
  {%- if section.settings.is_slider -%}
      </div>
      
      {%- if section.settings.show_arrow_nav -%}
        <div class="glide__arrows" data-glide-el="controls">
          <button
            class="glide__arrow glide__arrow--left {{ section.settings.arrow_nav_classes }}{% if section.settings.slider_breakpoint_limit != 'none' %} {{ section.settings.slider_breakpoint_limit }}:hidden{% endif %}"
            aria-label="Go to previous"
            data-glide-dir="<"
          >
            {% render 'icon-chevron', aria_hidden: true, stroke_width: 2, classes: 'h-10 w-10 text-seaweed-700 bg-white rounded-full block border-y-4 border-r-2 border-l-6 border-white' %}
          </button>
          <button
            class="glide__arrow glide__arrow--right {{ section.settings.arrow_nav_classes }}{% if section.settings.slider_breakpoint_limit != 'none' %} {{ section.settings.slider_breakpoint_limit }}:hidden{% endif %}"
            aria-label="Go to next"
            data-glide-dir=">"
          >
            {% render 'icon-chevron', aria_hidden: true, stroke_width: 2, classes: 'h-10 w-10 text-seaweed-700 bg-white rounded-full block border-y-4 border-r-2 border-l-6 border-white rotate-180' %}
          </button>
        </div>
      {%- endif -%}

      {%- if section.settings.show_dot_nav -%}
        <ol
          class="glide__bullets flex {{ section.settings.dot_nav_classes }}{% if section.settings.slider_breakpoint_limit != 'none' %} {{ section.settings.slider_breakpoint_limit }}:hidden{% endif %}"
          data-glide-el="controls[nav]"
        >
          {%- for dot in (1..section.settings.slider_indicator_count) -%}
            <li
              type="button"
              class="glide__bullet p-2{% if forloop.first %} active{% endif %}"
              data-glide-dir="={{ forloop.index0 }}"
            >
              <span class="sr-only">Go to slide {{ forloop.index }}</span>
              <span class="block w-2 h-2 bg-seaweed-700 rounded-full"></span>
            </li>
          {%- endfor -%}
        </ol>
      {%- endif -%}
    </glide-slider>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "t:sections.multicolumn.name",
  "tag": "section",
  "settings": [
    {
      "type": "textarea",
      "id": "section_classes",
      "label": "Section classes"
    },
    {
      "type": "textarea",
      "id": "container_classes",
      "label": "Container classes"
    },
    {
      "type": "image_picker",
      "id": "row_bg_image",
      "label": "Background image (optional)"
    },
    {
      "type": "header",
      "content": "Slider settings"
    },
    {
      "type": "checkbox",
      "id": "is_slider",
      "default": false,
      "label": "Slider"
    },
    {
      "type": "number",
      "default": 3,
      "id": "slider_indicator_count",
      "label": "Number of dot indicators to display"
    },
    {
      "type": "select",
      "default": "none",
      "id": "slider_breakpoint_limit",
      "info": "When window is above a certain size and all the slides can fit on one screen, disable the slider.",
      "label": "Disable slider at breakpoint",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "sm",
          "label": "Small (640px)"
        },
        {
          "value": "md",
          "label": "Medium (768px)"
        },
        {
          "value": "lg",
          "label": "Large (1024px)"
        },
        {
          "value": "xl",
          "label": "X-Large (1280px)"
        }
      ]
    },
    {
      "type": "textarea",
      "id": "slider_classes",
      "label": "Slider classes"
    },
    {
      "type": "checkbox",
      "id": "show_arrow_nav",
      "default": true,
      "label": "Show arrow nav"
    },
    {
      "type": "textarea",
      "default": "top-1/2 -translate-y-1/2",
      "id": "arrow_nav_classes",
      "label": "Arrow nav classes"
    },
    {
      "type": "checkbox",
      "id": "show_dot_nav",
      "default": false,
      "label": "Show dot nav"
    },
    {
      "type": "textarea",
      "default": "absolute bottom-1 left-1/2 -translate-x-1/2",
      "id": "dot_nav_classes",
      "label": "Dot nav classes"
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "settings": [
        {
          "type": "header",
          "content": "General settings"
        },
        {
          "type": "textarea",
          "id": "column_classes",
          "label": "Column classes"
        },
        {
          "type": "header",
          "content": "Image settings"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.multicolumn.blocks.column.settings.image.label"
        },
        {
          "type": "image_picker",
          "id": "image_desktop",
          "info": "Provide a different image for desktop view",
          "label": "Image (desktop)"
        },
        {
          "type": "checkbox",
          "id": "is_bg_image",
          "label": "Background image"
        },
        {
          "type": "url",
          "id": "image_link",
          "label": "Image link (optional)"
        },
        {
          "type": "textarea",
          "id": "image_classes",
          "label": "Image classes"
        },
        {
          "type": "textarea",
          "id": "image_wrapper_classes",
          "label": "Image wrapper classes"
        },
        {
          "type": "header",
          "content": "Text settings"
        },
        {
          "type": "textarea",
          "id": "text_classes",
          "label": "Text block classes"
        },
        {
          "type": "html",
          "id": "heading",
          "info": "This field takes HTML.",
          "label": "Heading"
        },
        {
          "type": "textarea",
          "id": "heading_classes",
          "label": "Heading classes"
        },
        {
          "type": "html",
          "id": "paragraph",
          "info": "This field takes HTML.",
          "label": "Paragraph"
        },
        {
          "type": "textarea",
          "id": "paragraph_classes",
          "label": "Paragraph classes"
        },
        {
          "type": "header",
          "content": "Button settings"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Button link"
        },
        {
          "type": "textarea",
          "id": "button_classes",
          "label": "Button classes"
        },
        {
          "type": "html",
          "id": "button_icon",
          "info": "Format: SVG",
          "label": "Button icon"
        },
        {
          "type": "checkbox",
          "id": "is_atc_button",
          "label": "Add to cart button"
        },
        {
          "type": "product",
          "id": "atc_button_product",
          "label": "Product to add"
        }
      ]
    },
    {
      "type": "product",
      "name": "Product Tile",
      "settings": [
        {
          "type": "textarea",
          "id": "column_classes",
          "label": "Column classes"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "image_picker",
          "id": "custom_product_image",
          "label": "Custom image"
        },
        {
          "type": "textarea",
          "id": "image_classes",
          "label": "Image classes"
        },
        {
          "type": "checkbox",
          "id": "hide_badge",
          "label": "Hide badge"
        },
        {
          "type": "checkbox",
          "id": "subscription",
          "label": "Subscription tile"
        }
      ]
    },
    {
      "type": "code",
      "name": "Code block",
      "settings": [
        {
          "type": "textarea",
          "id": "column_classes",
          "label": "Column classes"
        },
        {
          "type": "html",
          "id": "code",
          "info": "This field takes HTML.",
          "label": "Code block"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.multicolumn.presets.name",
      "blocks": [
        {
          "type": "column"
        }
      ]
    }
  ]
}
{% endschema %}
