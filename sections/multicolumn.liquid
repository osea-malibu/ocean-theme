<div class="{{ section.settings.multicolumn_classes }}">
  {%- if section.settings.is_slider -%}
    <slider-component
      class="
        {% if section.settings.is_slider and section.blocks.size > 1 %}slider{% endif %} 
        {% if section.settings.slider_breakpoint_limit != 'none' %}{{ section.settings.slider_breakpoint_limit }}:pb-0{% endif %} 
        {{ section.settings.slider_classes }}
      "
    >
  {%- endif -%}
    <ul
      class="{% if section.settings.is_slider %}slider-container{% else %}flex md:flex-shrink-0{% endif %} {{ section.settings.row_classes }}"
      role="list"
      {% if section.settings.row_bg_image != blank %}
        style="background-image: url({{ section.settings.row_bg_image | image_url: width: 1420 }})"
      {% endif %}
    >
      {%- for block in section.blocks -%}
        <li
          class="{{ block.settings.column_classes }}{% if block.settings.is_bg_image %} bg-cover{% endif %}"
          {% if block.settings.is_bg_image %}style="background-image: url({{ block.settings.image | image_url: width: 1420 }})"{% endif %}
          {{ block.shopify_attributes }}
        >
          {%- case block.type -%}
            {%- when 'column' %}
              {%- if block.settings.image != nil and block.settings.is_bg_image == false -%}
                {%- if block.settings.image_link != nil -%}
                  <a href="{{ block.settings.image_link }}">
                {%- endif -%}
                  <picture class="{{ block.settings.image_wrapper_classes }}">
                    {%- if block.settings.image_desktop != nil -%}
                      <source
                        srcset="{{ block.settings.image_desktop | image_url: width: 800 }} 1x, {{ block.settings.image_desktop | image_url: width: 1600 }} 2x"
                        media="(min-width: 640px)"
                      >
                    {%- else -%}
                      <source
                        srcset="{{ block.settings.image | image_url: width: 800 }} 1x, {{ block.settings.image | image_url: width: 1600 }} 2x"
                        media="(min-width: 640px)"
                      >
                    {%- endif -%}
                    <source
                      srcset="{{ block.settings.image | image_url: width: 400 }} 1x, {{ block.settings.image | image_url: width: 800 }} 2x"
                      media="(min-width: 0px)"
                    >
                    <img
                      srcset="{{ block.settings.image | image_url: width: 400 }} 1x, {{ block.settings.image | image_url: width: 800 }} 2x"
                      src="{{ block.settings.image | image_url: width: 800 }}"
                      alt="{{ block.settings.image.alt }}"
                      height="{{ block.settings.image.height }}"
                      width="{{ block.settings.image.width }}"
                      class="{{ block.settings.image_classes }}"
                      loading="lazy"
                    >
                  </picture>
                {%- if block.settings.image_link != nil -%}
                  </a>
                {%- endif -%}
              {%- endif -%}
              {%- if block.settings.heading != "" or block.settings.paragraph != "" or block.settings.button_label != "" -%}
                <div class="{{ block.settings.text_classes }}">
                  {%- if block.settings.heading != "" -%}
                    <div class="{{ block.settings.heading_classes }}">{{- block.settings.heading -}}</div>
                  {%- endif -%}
                  {%- if block.settings.paragraph != "" -%}
                    <div class="{{ block.settings.paragraph_classes }}">{{- block.settings.paragraph -}}</div>
                  {%- endif -%}
                  {%- if block.settings.button_label != "" -%}
                    <a class="button {{ block.settings.button_classes }}" {% if block.settings.link == blank %}role="link" aria-disabled="true"{% else %}href="{{ block.settings.link }}"{% endif %}>{{- block.settings.button_label | escape -}}</a>
                  {%- endif -%}
                </div>
              {%- endif -%}
            {%- when 'product' %}
              {%- if block.settings.product -%}
                {% render 'product-card',
                  product_card_product: all_products[block.settings.product],
                  show_secondary_image_on_hover: true,
                  custom_default_image: block.settings.custom_product_image
                  hide_badge: block.settings.hide_badge,
                  subscription: block.settings.subscription
                %}
              {%- endif -%}
          {%- endcase -%}
        </li>
      {%- endfor -%}
    </ul>
  {%- if section.settings.is_slider -%}
    <button type="button" class="slider-nav slider-nav-prev{% if section.settings.slider_breakpoint_limit != 'none' %} {{ section.settings.slider_breakpoint_limit }}:hidden{% endif %}" aria-label="Go to previous">
      <svg aria-hidden="true" class="h-10 w-10 text-seaweed-700 bg-white rounded-full block border-y-4 border-r-2 border-l-6 border-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 18 9 12 15 6" />
      </svg>
    </button>
    <button type="button" class="slider-nav slider-nav-next xs:right-2{% if section.settings.slider_breakpoint_limit != 'none' %} {{ section.settings.slider_breakpoint_limit }}:hidden{% endif %}" aria-label="Go to next">
      <svg aria-hidden="true" class="h-10 w-10 text-seaweed-700 bg-white rounded-full block border-y-4 border-l-2 border-r-6 border-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="9 18 15 12 9 6" />
      </svg>
    </button>

    <ol class="slider-indicators{% if section.settings.slider_breakpoint_limit != 'none' %} {{ section.settings.slider_breakpoint_limit }}:hidden{% endif %}">
      {%- for dot in (1..section.settings.slider_indicator_count) -%}
        <li {% if forloop.first %}class="active"{% endif %}></li>
      {%- endfor -%}
    </ol>
    </slider-component>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "t:sections.multicolumn.name",
  "tag": "section",
  "settings": [
    {
      "type": "textarea",
      "id": "multicolumn_classes",
      "label": "Wrapper classes"
    },
    {
      "type": "textarea",
      "id": "row_classes",
      "label": "Row classes"
    },
    {
      "type": "image_picker",
      "id": "row_bg_image",
      "label": "Background image (optional)"
    },
    {
      "type": "header",
      "content": "Slider settings"
    },
    {
      "type": "checkbox",
      "id": "is_slider",
      "default": false,
      "label": "Slider"
    },
    {
      "type": "number",
      "default": 3,
      "id": "slider_indicator_count",
      "label": "Number of dot indicators to display"
    },
    {
      "type": "select",
      "default": "none",
      "id": "slider_breakpoint_limit",
      "info": "When window is above a certain size and all the slides can fit on one screen, disable the slider.",
      "label": "Disable slider at breakpoint",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "sm",
          "label": "Small (640px)"
        },
        {
          "value": "md",
          "label": "Medium (768px)"
        },
        {
          "value": "lg",
          "label": "Large (1024px)"
        },
        {
          "value": "xl",
          "label": "X-Large (1280px)"
        }
      ]
    },
    {
      "type": "textarea",
      "id": "slider_classes",
      "label": "Slider classes"
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "settings": [
        {
          "type": "header",
          "content": "General settings"
        },
        {
          "type": "textarea",
          "id": "column_classes",
          "label": "Column classes"
        },
        {
          "type": "header",
          "content": "Image settings"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.multicolumn.blocks.column.settings.image.label"
        },
        {
          "type": "image_picker",
          "id": "image_desktop",
          "info": "Provide a different image for desktop view",
          "label": "Image (desktop)"
        },
        {
          "type": "checkbox",
          "id": "is_bg_image",
          "label": "Background image"
        },
        {
          "type": "url",
          "id": "image_link",
          "label": "Image link (optional)"
        },
        {
          "type": "textarea",
          "id": "image_classes",
          "label": "Image classes"
        },
        {
          "type": "textarea",
          "id": "image_wrapper_classes",
          "label": "Image wrapper classes"
        },
        {
          "type": "header",
          "content": "Text settings"
        },
        {
          "type": "textarea",
          "id": "text_classes",
          "label": "Text block classes"
        },
        {
          "type": "html",
          "id": "heading",
          "info": "This field takes HTML.",
          "label": "Heading"
        },
        {
          "type": "textarea",
          "id": "heading_classes",
          "label": "Heading classes"
        },
        {
          "type": "html",
          "id": "paragraph",
          "info": "This field takes HTML.",
          "label": "Paragraph"
        },
        {
          "type": "textarea",
          "id": "paragraph_classes",
          "label": "Paragraph classes"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Button link"
        },
        {
          "type": "textarea",
          "id": "button_classes",
          "label": "Button classes"
        }
      ]
    },
    {
      "type": "product",
      "name": "Product Tile",
      "settings": [
        {
          "type": "textarea",
          "id": "column_classes",
          "label": "Column classes"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "image_picker",
          "id": "custom_product_image",
          "label": "Custom image"
        },
        {
          "type": "textarea",
          "id": "image_classes",
          "label": "Image classes"
        },
        {
          "type": "checkbox",
          "id": "hide_badge",
          "label": "Hide badge"
        },
        {
          "type": "checkbox",
          "id": "subscription",
          "label": "Subscription tile"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.multicolumn.presets.name",
      "blocks": [
        {
          "type": "column"
        }
      ]
    }
  ]
}
{% endschema %}
