{%- if section.blocks.size > 0 -%}
  <div class="container relative mb-6 lg:mb-12 flex w-full">
    <div class="content relative w-full bg-white rounded-xl p-6 lg:p-10">
      <h3 class="text-3xl sm:text-4xl lg:text-5xl font-serif tracking-tight mb-4 lg:mb-6 text-center">{{ section.settings.header }}</h3>
      <div class="mb-8 max-w-lg lg:max-w-full mx-auto lg:flex lg:items-start lg:justify-center {% if section.blocks.size > 3 %}lg:gap-4 xl:gap-16{% else %}lg:gap-12 xl:gap-24{% endif %}">
        {%- for block in section.blocks -%}
          {%- assign index_modulo = forloop.index0 | modulo: 2 -%}
          <div class="flex items-center gap-3 md:gap-6 mb-4 w-full lg:flex-col-reverse {% if index_modulo == 1 %}flex-row-reverse{% else %}flex-row{% endif %} {% if section.blocks.size > 3 %}lg:w-52 xl:w-60{% elsif section.blocks.size > 2 %}lg:w-60 xl:w-64{% else %}lg:w-64 xl:w-72{% endif %}">
            <div class="relative w-full lg:text-center{% if index_modulo == 1 %} text-right{% endif %}">
              <p class="relative block mb-2 text-lg/snug md:text-xl lg:text-2xl lg:leading-6 after:content-[''] after:block after:w-full after:h-px after:bg-p-core before:content-[''] before:block before:bg-p-core before:w-[5px] before:h-[5px] before:rounded-full before:absolute before:bottom-[-2px] {% if index_modulo == 1 %}before:left-0{% else %}before:right-0{% endif %} lg:before:hidden lg:after:hidden">
                <b class="font-medium">{{ block.settings.ingredient_name | split: ' [' | first }}</b>
              </p>
              <div class="leading-tight">
                {%- if block.settings.ingredient_description != blank -%}
                  <p class="md:text-lg/tight">{{ block.settings.ingredient_description | strip_html }}</p>
                {%- endif -%}
                {%- if block.settings.ingredient_citation != blank -%}
                  <cite>{{ block.settings.ingredient_citation }}</cite>
                {%- endif -%}
              </div>
            </div>
            {%- if block.settings.ingredient_image -%}
              {%- assign ingredient_master = block.settings.ingredient_image | image_url -%}
              {% comment %} theme-check-disable RemoteAsset {% endcomment %}
              <img 
                src="{% render 'imgix', src: ingredient_master, w: 192 %}"
                srcset="
                  {% render 'imgix', src: ingredient_master, w: 128 %} 128w,
                  {% render 'imgix', src: ingredient_master, w: 192 %} 192w,
                  {% render 'imgix', src: ingredient_master, w: 256 %} 256w,
                  {% render 'imgix', src: ingredient_master, w: 320 %} 320w,
                  {% render 'imgix', src: ingredient_master, w: 384 %} 384w
                "
                sizes="(min-width: 1024px) 176px, (min-width: 768px) 144px, 112px"
                alt=""
                aria-hidden="true"
                height="{{ block.settings.ingredient_image.height }}"
                width="{{ block.settings.ingredient_image.width }}"
                class="block rounded-full w-28 h-28 md:w-36 md:h-36 lg:w-44 lg:h-44 shrink-0"
                loading="lazy"
              >
              {% comment %} theme-check-enable RemoteAsset {% endcomment %}
            {%- else -%}
              <div class="block rounded-full w-28 h-28 md:w-36 md:h-36 lg:w-44 lg:h-44 shrink-0 bg-p-core"></div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>
      <modal-opener class="no-js-hidden block text-center" data-modal="#IngredientsPopup">
        <button class="button button-secondary button-sm lg:button-md" type="button" aria-haspopup="dialog">Full ingredients list</button>
      </modal-opener>
    </div>
    <modal-dialog id="IngredientsPopup">
      <div role="dialog" aria-label="Full ingredients list" aria-modal="true" class="!pr-4" tabindex="-1">
        <button id="ModalClose-IngredientsPopup" type="button" aria-label="{{ 'accessibility.close' | t }}">
          {%- render 'icon-close', classes: 'w-8 h-8', stroke_width: 1, aria_hidden: true -%}
        </button>
        <div class="w-full max-h-96 overflow-auto pr-4">
          <h2 class="font-serif text-3xl tracking-tight mb-2">Ingredients</h2>
          {{ section.settings.full_ingredients }}
          <cite class="text-sm mt-4 leading-tight block">From time to time, ingredients may be updated. Please check the product packaging for the latest ingredient list.</cite>
        </div>
      </div>
    </modal-dialog>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Ingredients with Images",
  "tag": "section",
  "class": "product-ingredients-images",
  "settings": [
    {
      "type": "paragraph",
      "content": "This section is powered by the product metafields labeled 'Key ingredients'."
    },
    {
      "type": "text",
      "id": "header",
      "label": "Header",
      "default": "Ingredients"
    },
    {
      "type": "text",
      "id": "full_ingredients",
      "label": "Ingredients",
      "info": "Connect data source 'Ingredients'"
    }
  ],
  "blocks": [
    {
      "type": "key_ingredient",
      "name": "Key Ingredient",
      "settings": [
        {
          "type": "text",
          "id": "ingredient_name",
          "label": "Name"
        },
        {
          "type": "text",
          "id": "ingredient_scientific_name",
          "label": "Scientific name"
        },
        {
          "type": "text",
          "id": "ingredient_description",
          "label": "Description"
        },
        {
          "type": "text",
          "id": "ingredient_citation",
          "label": "Citation"
        },
        {
          "type": "image_picker",
          "id": "ingredient_image",
          "label": "Image",
          "info": "Size: 800w x 800h"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Ingredients with Images",
      "blocks": [
        {
          "type": "key_ingredient"
        }
      ]
    }
  ]
}
{% endschema %}
