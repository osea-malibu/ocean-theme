<div class="bg-seaweed-700 flex justify-center px-4" id="AnnouncementBar">
  {% comment %} Gift with purchase {% endcomment %}
  {%- if settings.enable_gwp and settings.gwp_type == 'auto' -%}
    {%- liquid
      assign cart_ids = cart.items | map: 'product_id'
      assign tier1_product = all_products[settings.gwp_tier1_product]
      assign tier2_product = all_products[settings.gwp_tier2_product]
      assign tier3_product = all_products[settings.gwp_tier2_product]

      assign gwp_threshold = settings.gwp_tier1_threshold | times: 100
      assign remaining_amount = gwp_threshold | minus: cart.total_price
      assign remaining_amount_money = remaining_amount | money
      assign countdown_text = settings.gwp_tier1_text | replace: 'remaining_amount', remaining_amount_money | replace: 'gift_product', tier1_product.title | replace: 'Free Gift - '
      assign countdown_text_mobile = settings.gwp_tier1_text | replace: 'remaining_amount', remaining_amount_money | replace: 'gift_product', 'gift' | replace: 'Free Gift - '

      if cart_ids contains tier2_product.id
        if settings.gwp_tier3_product != nil
          assign tier3_product = all_products[settings.gwp_tier3_product]
          assign gwp_threshold = settings.gwp_tier3_threshold | times: 100
          assign countdown_text = settings.gwp_tier3_text | replace: 'remaining_amount', remaining_amount_money | replace: 'gift_product', tier3_product.title | replace: 'Free Gift - '
        endif
      elsif cart_ids contains tier1_product.id
        if settings.gwp_tier2_product != nil
          assign gwp_threshold = settings.gwp_tier2_threshold | times: 100
          assign countdown_text = settings.gwp_tier2_text | replace: 'remaining_amount', remaining_amount_money | replace: 'gift_product', tier2_product.title | replace: 'Free Gift - '
        endif
      endif
    -%}

    {%- unless settings.gwp_tier1_product == nil -%}
      <p class="text-white font-book text-center py-1 tracking-wide">
        {%- if remaining_amount > 0 -%}
          <span class="hidden sm:block">{{ countdown_text }}</span>
          <span class="sm:hidden">{{ countdown_text_mobile }}</span>
        {%- else -%}
          {{ settings.gwp_success_text }}
        {%- endif -%}
      </p>
    {%- endunless -%}
  {% comment %} Slider announcement bar {% endcomment %}
  {%- elsif section.blocks.size > 1 -%}
    <div class="slider slider-nav-autoplay slider-nav-outside max-w-xl" data-slider-nav-autoplay-interval={{ section.settings.slide_interval | times: 1000 }}>
      <ul class="slider-container">
        {%- for block in section.blocks -%}
          {%- if block.settings.text != blank -%}
            <li class="text-white text-base font-book text-center py-1 tracking-wider" role="region" aria-label="{{ block.settings.text | strip_html }}">
              {{ block.settings.text }}
            </li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
      <button type="button" class="slider-nav slider-nav-small"></button>
      <button type="button" class="slider-nav slider-nav-small slider-nav-next"></button>
    </div>
  {%- else -%}
    <div class="text-white text-base font-book text-center py-1 tracking-wider" role="region" aria-label="{{ section.blocks[0].settings.text | strip_html }}">
      {{ section.blocks[0].settings.text }}
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Announcement bar",
  "class": "inset-x-0 fixed top-0 z-30",
  "max_blocks": 12,
  "settings": [
    {
      "type": "paragraph",
      "content": "Adding more than 1 visible announcement converts text into a carousel. For best performance keep only 1 announcement active at a time."
    },
    {
      "default": 3,
      "id": "slide_interval",
      "info": "Number of seconds before slide changes when there is more than one announcement",
      "label": "Slide change interval",
      "max": 20,
      "min": 0,
      "step": 1,
      "type": "range",
      "unit": "sec"
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "default": "<p>Free shipping on orders over $50</p>",
          "label": "Text"
        }
      ]
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "announcement"
      }
    ]
  }
}
{% endschema %}
